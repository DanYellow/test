name: PR to master
run-name: ${{ github.actor }} is testing out GitHub Actions ðŸš€ - ${{ github.ref }}
on:
  pull_request:
    branches: [main]
    types: [ opened, reopened, edited ]

jobs:
  # unit_tests:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: Check out repository code
  #       uses: actions/checkout@v4
  #     - name: Set github user
  #       run: git config --global user.email "test@example.com" && git config --global user.name "CI/CD"
  #     - name: Install the dependencies
  #       run: npm ci
  #     - run: echo "$FOO"
  #     # - run: echo "${{toJSON(github)}}"
  #     - name: Run unit tests
  #       run: npm run test --if-present
  #     # - name: Display date
  #     #   run: FOO=$(date +'%Y-%m-%dT%H:%M:%S')
  #     - name: Display date
  #       run: echo "MY_VAR=$(date +'%Y/%m/%d')" >> "$GITHUB_ENV"
  #     - run: |
  #         printf '%s\n' "$VITE_HELLO" # This will output 'yellow'
  e2e_tests:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository code
        uses: actions/checkout@v4
      - name: Set github user
        run: git config user.email "test@example.com" && git config user.name "CI/CD"
      - name: Install the dependencies
        run: npm ci
      - name: Install playwright
        run: npx playwright install --with-deps
      - name: Run smoke tests
        run: npx playwright test --project=chromium --grep @smoke
      - name: Run non-smoke tests
        run: npx playwright test --project=chromium --grep-invert @smoke
  build:
    # needs: [e2e_tests]
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository code
        uses: actions/checkout@v4
      - name: Set github user
        run: git config --global user.email "test@example.com" && git config --global user.name "CI/CD"
      - name: Install the dependencies
        run: npm ci
      - name: Display date
        run: echo "VITE_HELLO=$(date +'%Y-%m-%dT%H-%M-%S')" >> "$GITHUB_ENV"
      - name: Create build
        run: npm run build
      - run: |
          chmod +x ${{ github.workspace }}/copy.sh
          ${{ github.workspace }}/copy.sh ${{ github.workspace }}
      - name: Generate artifact
        uses: actions/upload-artifact@master
        with:
          name: bundle
          path: ./dist
